package vulnerability

import (
	"context"
	"errors"

	"github.com/modelcontextprotocol/go-sdk/mcp"
	"github.com/stackrox/stackrox-mcp/internal/toolsets"
)

// listClusterCVEsInput defines the input parameters for list_cluster_cves tool.
type listClusterCVEsInput struct {
	ClusterID string `json:"clusterId,omitempty"`
}

// listClusterCVEsOutput defines the output structure for list_cluster_cves tool.
type listClusterCVEsOutput struct {
	CVEs []string `json:"cves"`
}

// listClusterCVEsTool implements the list_cluster_cves tool.
type listClusterCVEsTool struct {
	name string
}

// NewListClusterCVEsTool creates a new list_cluster_cves tool.
func NewListClusterCVEsTool() toolsets.Tool {
	return &listClusterCVEsTool{
		name: "list_cluster_cves",
	}
}

// IsReadOnly returns true as this tool only reads data.
func (t *listClusterCVEsTool) IsReadOnly() bool {
	return true
}

// GetName returns the tool name.
func (t *listClusterCVEsTool) GetName() string {
	return t.name
}

// GetTool returns the MCP Tool definition.
func (t *listClusterCVEsTool) GetTool() *mcp.Tool {
	return &mcp.Tool{
		Name: t.name,
		//nolint:lll
		Description: "List CVEs affecting a specific cluster or all clusters in StackRox Central with CVE names, scores, affected images, and deployments",
	}
}

// RegisterWith registers the list_cluster_cves tool handler with the MCP server.
func (t *listClusterCVEsTool) RegisterWith(server *mcp.Server) {
	mcp.AddTool(server, t.GetTool(), t.handle)
}

// handle is the placeholder handler for list_cluster_cves tool.
func (t *listClusterCVEsTool) handle(
	_ context.Context,
	_ *mcp.CallToolRequest,
	_ listClusterCVEsInput,
) (*mcp.CallToolResult, *listClusterCVEsOutput, error) {
	return nil, nil, errors.New("list_cluster_cves tool is not yet implemented")
}
