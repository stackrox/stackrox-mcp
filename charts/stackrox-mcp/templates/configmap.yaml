apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "stackrox-mcp.configMapName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "stackrox-mcp.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Central connection configuration
    central:
      url: {{ .Values.config.central.url | quote }}
      auth_type: "passthrough"
      insecure_skip_tls_verify: {{ .Values.config.central.insecureSkipTLSVerify }}
      force_http1: {{ .Values.config.central.forceHTTP1 }}
      request_timeout: {{ .Values.config.central.requestTimeout | quote }}
      max_retries: {{ .Values.config.central.maxRetries }}
      initial_backoff: {{ .Values.config.central.initialBackoff | quote }}
      max_backoff: {{ .Values.config.central.maxBackoff | quote }}

    # Global MCP server configuration
    global:
      read_only_tools: {{ .Values.config.global.readOnlyTools }}

    # HTTP server configuration
    server:
      type: {{ .Values.config.server.type | quote }}
      address: {{ .Values.config.server.address | quote }}
      port: {{ .Values.config.server.port }}

    # MCP tools configuration
    {{- if not (or .Values.config.tools.vulnerability.enabled .Values.config.tools.configManager.enabled) }}
    {{ fail "At least one tool has to be enabled. Enable check 'config.tools' in helm values." }}
    {{- end }}
    tools:
      vulnerability:
        enabled: {{ .Values.config.tools.vulnerability.enabled }}
      config_manager:
        enabled: {{ .Values.config.tools.configManager.enabled }}
